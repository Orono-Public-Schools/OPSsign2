<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPSsign2 Admin - Orono Public Schools</title>
    <link rel="stylesheet" href="/admin/admin.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <h1>OPS Digital Signage Admin</h1>
                <p>Orono Public Schools</p>
            </div>
            <div class="user-section">
                <div class="user-info">
                    <img id="userPhoto" src="" alt="User Photo" class="user-photo">
                    <div class="user-details">
                        <span id="userName">Loading...</span>
                        <span id="userEmail" class="user-email">Loading...</span>
                    </div>
                </div>
                <a href="/" class="btn-nav">‚Üê Homepage</a>
            </div>
        </div>
    </header>

    <main class="main-content">
        <section class="overview-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Devices</h3>
                    <div class="stat-number" id="totalDevices">-</div>
                </div>
                <div class="stat-card">
                    <h3>Online</h3>
                    <div class="stat-number online" id="onlineDevices">-</div>
                </div>
                <div class="stat-card">
                    <h3>Offline</h3>
                    <div class="stat-number offline" id="offlineDevices">-</div>
                </div>
                <div class="stat-card">
                    <h3>Templates</h3>
                    <div class="stat-number" id="totalTemplates">5</div>
                </div>
            </div>
        </section>

        <section class="devices-section">
            <div class="section-header">
                <h2>Device Management</h2>
                <button id="addDeviceBtn" class="btn btn-primary">
                    <span>+</span> Add Device
                </button>
            </div>

            <div class="devices-grid" id="devicesGrid">
                <!-- Devices will be populated by JavaScript -->
                <div class="loading">Loading devices...</div>
            </div>
        </section>

        <section class="templates-section">
            <h2>Templates & Themes</h2>
            <div class="templates-themes-grid">
                <div class="template-card">
                    <h3>Standard Template</h3>
                    <p>Basic presentation with footer</p>
                    <div class="template-preview">üì±</div>
                </div>
                <div class="template-card">
                    <h3>Sidebar Template</h3>
                    <p>Presentation with weather sidebar</p>
                    <div class="template-preview">üì±</div>
                </div>
                <div class="template-card">
                    <h3>Weather Template</h3>
                    <p>Detailed weather information</p>
                    <div class="template-preview">üì±</div>
                </div>
                <div class="template-card">
                    <h3>Announcement Template</h3>
                    <p>Eye-catching announcements and alerts</p>
                    <div class="template-preview">üì¢</div>
                </div>
                <div class="template-card">
                    <h3>Full-Screen Template</h3>
                    <p>Slideshow only, no branding or UI</p>
                    <div class="template-preview">üñ•Ô∏è</div>
                </div>
            </div>
        </section>

        <!-- NEW: Alert Management Section -->
        <section class="alerts-section">
            <div class="section-header">
                <h2>Alert Management</h2>
                <div class="alert-stats">
                    <span class="stat-item">
                        <span class="stat-label">Total:</span>
                        <span class="stat-number" id="totalAlerts">0</span>
                    </span>
                    <span class="stat-item">
                        <span class="stat-label">Active:</span>
                        <span class="stat-number active" id="activeAlerts">0</span>
                    </span>
                    <span class="stat-item">
                        <span class="stat-label">High Priority:</span>
                        <span class="stat-number priority-high" id="highPriorityAlerts">0</span>
                    </span>
                </div>
            </div>

            <!-- Add New Alert Form -->
            <div class="alert-form-container">
                <h3>Add New Alert</h3>
                <form id="alertForm" class="alert-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="alertName">Alert Name</label>
                            <input type="text" id="alertName" name="alertName" required 
                                   placeholder="e.g., Weather Delay - 2 Hour Late Start">
                        </div>
                        
                        <div class="form-group">
                            <label for="alertSlideId">Google Slides ID</label>
                            <input type="text" id="alertSlideId" name="alertSlideId" required 
                                   placeholder="Google Slides ID for this alert">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="alertPriority">Priority Level</label>
                            <select id="alertPriority" name="alertPriority" required>
                                <option value="low">Low Priority</option>
                                <option value="medium" selected>Medium Priority</option>
                                <option value="high">High Priority</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="alertExpires">Expiration (Optional)</label>
                            <input type="datetime-local" id="alertExpires" name="alertExpires">
                        </div>
                    </div>

                    <!-- Building Selection -->
                    <div class="form-group building-selection">
                        <label>Target Buildings</label>
                        
                        <!-- Quick Select Buttons -->
                        <div class="quick-select-buttons">
                            <button type="button" onclick="selectAllSchools()">All Schools</button>
                            <button type="button" onclick="selectElementaryLevel()">Elementary Level</button>
                            <button type="button" onclick="selectSecondaryLevel()">Secondary Level</button>
                            <button type="button" onclick="selectAllBuildings()">All Buildings</button>
                            <button type="button" onclick="clearAllBuildings()">Clear All</button>
                        </div>
                        
                        <!-- Building Checkboxes -->
                        <div class="building-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" value="SE" name="buildings">
                                <span class="building-code">SE</span> - Schumann Elementary
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="IS" name="buildings">
                                <span class="building-code">IS</span> - Intermediate School
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="MS" name="buildings">
                                <span class="building-code">MS</span> - Middle School
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="HS" name="buildings">
                                <span class="building-code">HS</span> - High School
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="DC" name="buildings">
                                <span class="building-code">DC</span> - Discovery Center
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="DO" name="buildings">
                                <span class="building-code">DO</span> - District Office
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Add Alert</button>
                    </div>
                </form>
            </div>

            <!-- Alerts Table -->
            <div class="alerts-table-container">
                <div class="table-header">
                    <h3>Current Alerts</h3>
                    <div class="table-controls">
                        <button onclick="refreshAlerts()" class="btn btn-secondary">
                            <span id="refreshAlertsText">Refresh</span>
                        </button>
                        <select id="alertFilter" onchange="filterAlerts()">
                            <option value="all">All Alerts</option>
                            <option value="active">Active Only</option>
                            <option value="high">High Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>
                </div>
                
                <div class="alerts-grid" id="alertsGrid">
                    <div class="loading" id="alertsLoading">Loading alerts...</div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add Device Modal -->
    <div id="addDeviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Device</h3>
                <span class="modal-close">&times;</span>
            </div>
            <form id="addDeviceForm">
                <div class="form-group">
                    <label for="deviceId">Device ID</label>
                    <input type="text" id="deviceId" name="deviceId" required
                           placeholder="e.g., lobby-1, cafe-2">
                </div>
                <div class="form-group">
                    <label for="ipAddress">IP Address</label>
                    <input type="text" id="ipAddress" name="ipAddress"
                           placeholder="e.g., 10.1.1.100"
                           pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$">
                </div>
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" required
                           placeholder="e.g., Main Lobby, Cafeteria">
                </div>
                <!-- NEW: Building field -->
                <div class="form-group">
                    <label for="building">Building</label>
                    <select id="building" name="building" required>
                        <option value="">Select Building</option>
                        <option value="SE">SE - Schumann Elementary</option>
                        <option value="IS">IS - Intermediate School</option>
                        <option value="MS">MS - Middle School</option>
                        <option value="HS">HS - High School</option>
                        <option value="DC">DC - Discovery Center</option>
                        <option value="DO">DO - District Office</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="template">Template</label>
                    <select id="template" name="template">
                        <option value="standard">Standard</option>
                        <option value="sidebar">Sidebar</option>
                        <option value="weather">Weather</option>
                        <option value="announcement">Announcement</option>
                        <option value="fullscreen">Full-Screen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="theme">Theme</label>
                    <select id="theme" name="theme">
                        <option value="default">Default</option>
                        <option value="dark">Dark</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="slideId">Google Slide ID</label>
                    <input type="text" id="slideId" name="slideId"
                           placeholder="Presentation ID from Google Slides">
                </div>
                <div class="form-group">
                    <label for="refreshInterval">Refresh Interval (minutes)</label>
                    <input type="number" id="refreshInterval" name="refreshInterval"
                           value="15" min="1" max="120">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelAdd">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Device</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert Edit Modal -->
    <div id="alertEditModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Alert</h3>
                <span class="modal-close" onclick="closeAlertEditModal()">&times;</span>
            </div>
            <form id="alertEditForm">
                <input type="hidden" id="editAlertId">
                
                <div class="form-group">
                    <label for="editAlertName">Alert Name</label>
                    <input type="text" id="editAlertName" name="alertName" required>
                </div>
                
                <div class="form-group">
                    <label for="editAlertSlideId">Google Slides ID</label>
                    <input type="text" id="editAlertSlideId" name="alertSlideId" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editAlertPriority">Priority</label>
                        <select id="editAlertPriority" name="alertPriority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editAlertExpires">Expires</label>
                        <input type="datetime-local" id="editAlertExpires" name="alertExpires">
                    </div>
                </div>
                
                <!-- Edit Building Selection -->
                <div class="form-group building-selection">
                    <label>Target Buildings</label>
                    <div class="building-checkboxes" id="editBuildingCheckboxes">
                        <label class="checkbox-label">
                            <input type="checkbox" value="SE" name="editBuildings">
                            <span class="building-code">SE</span> - Schumann Elementary
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="IS" name="editBuildings">
                            <span class="building-code">IS</span> - Intermediate School
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="MS" name="editBuildings">
                            <span class="building-code">MS</span> - Middle School
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="HS" name="editBuildings">
                            <span class="building-code">HS</span> - High School
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="DC" name="editBuildings">
                            <span class="building-code">DC</span> - Discovery Center
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="DO" name="editBuildings">
                            <span class="building-code">DO</span> - District Office
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" onclick="closeAlertEditModal()" class="btn btn-secondary">Cancel</button>
                    <button type="button" onclick="saveAlertEdit()" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/admin/admin.js"></script>
</body>
</html>