<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPS Digital Signage - {LOCATION}</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="{THEME_PATH}">
    <style>
        /* Announcement-specific styles */
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #banner {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            height: 12vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #banner img {
            height: 80%;
            filter: brightness(0) invert(1);
        }

        .announcement-overlay {
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        #slideContainer {
            height: 73vh;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #slideContainer iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Custom announcement content when no slides */
        .announcement-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 2rem;
        }

        .announcement-title {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 2rem;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
            animation: pulse 2s ease-in-out infinite alternate;
        }

        .announcement-message {
            font-size: 2.5rem;
            line-height: 1.4;
            margin-bottom: 3rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .announcement-details {
            font-size: 1.8rem;
            opacity: 0.9;
            display: flex;
            gap: 3rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        #footer {
            height: 15vh;
            background: rgba(0, 0, 0, 0.3);
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            font-size: 1.2rem;
        }

        .footer-left {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-right {
            text-align: right;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .device-info {
            opacity: 0.8;
            font-size: 1rem;
        }

        .clock {
            font-size: 2rem;
            font-weight: bold;
        }

        /* Loading state - override the original */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: white;
            font-size: 1.2rem;
        }

        .loading::before {
            content: '';
            display: block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error state */
        .error-message {
            color: #ff6b6b;
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 8px;
            border: 2px solid #ff6b6b;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .announcement-title { font-size: 3rem; }
            .announcement-message { font-size: 2rem; }
            .announcement-details { font-size: 1.5rem; }
        }

        @media (max-width: 768px) {
            #banner { height: 10vh; }
            #slideContainer { height: 75vh; }
            #footer { height: 15vh; flex-direction: column; }
            .announcement-title { font-size: 2.5rem; }
            .announcement-message { font-size: 1.5rem; }
            .announcement-details { 
                font-size: 1.2rem; 
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="banner">
        <img src="/assets/ops-torch.png" alt="Orono Public Schools Logo">
        <div class="announcement-overlay">ðŸ“¢ ANNOUNCEMENT</div>
    </div>

    <div id="slideContainer">
        <!-- Loading state (will be shown initially) -->
        <div class="loading" id="loadingState">
            Loading presentation...
        </div>
        
        <!-- Default announcement content (will be shown if no slideId) -->
        <div class="announcement-content" id="announcementContent" style="display: none;">
            <div class="announcement-title">Important Announcement</div>
            <div class="announcement-message">
                Welcome to {LOCATION}<br>
                Please check the latest updates on our website
            </div>
            <div class="announcement-details">
                <span>ðŸ“§ Contact: office@orono.k12.mn.us</span>
                <span>ðŸ“ž Phone: (952) 449-8300</span>
            </div>
        </div>
    </div>

    <div id="footer">
        <div class="footer-left">
            <div class="device-info">
                <span id="deviceId">Device: {DEVICE_ID}</span>
            </div>
            <div class="device-info">
                <span id="lastUpdate">Updated: Loading...</span>
            </div>
        </div>
        <div class="footer-right">
            <div class="clock" id="clock"></div>
            <div class="device-info">
                <span>{LOCATION}</span>
            </div>
        </div>
    </div>

    <script>
        // Update clock every second
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('clock').textContent = timeString;
        }

        // Update clock immediately and then every second
        updateClock();
        setInterval(updateClock, 1000);

        // Update last update time
        document.getElementById('lastUpdate').textContent = 'Updated: ' + new Date().toLocaleTimeString();

        // Template initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Announcement template loaded');
            
            // Check if we have a slideId from the URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const slideId = urlParams.get('slideId');
            
            // Also check if the parent application has set a slideId
            // Wait a moment for the parent to potentially set up slides
            setTimeout(() => {
                const slideIframe = document.querySelector('#slideContainer iframe');
                const hasSlideId = slideId || slideIframe || '{PRESENTATION_ID}' !== '';
                
                if (!hasSlideId || '{PRESENTATION_ID}' === '') {
                    console.log('No slideId found, showing announcement content');
                    // Hide loading, show announcement content
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('announcementContent').style.display = 'flex';
                } else {
                    console.log('SlideId found, waiting for presentation to load');
                    // Keep loading state until iframe loads
                }
            }, 1000);
            
            // Add entrance animation
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 1s ease-in';
                document.body.style.opacity = '1';
            }, 100);
            
            console.log('Announcement template initialized for device: {DEVICE_ID}');
        });

        // Listen for when the main app might initialize slides
        // This is a fallback to hide loading if slides are being set up
        const originalInitializeSlide = window.parent && window.parent.initializeSlide;
        if (originalInitializeSlide) {
            window.parent.initializeSlide = function(slideId) {
                console.log('Slide being initialized:', slideId);
                document.getElementById('loadingState').style.display = 'none';
                return originalInitializeSlide.call(this, slideId);
            };
        }
    </script>
</body>
</html>